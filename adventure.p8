pico-8 cartridge // http://www.pico-8.com
version 38
__lua__
-- game loop
function _init()
	map_setup()
	make_player()
end

function _update()
	move_player()
end

function _draw()
	cls()
	draw_map()
	draw_player()
	if (btn(❎)) show_inventory()
end

-->8
-- map code
function map_setup()
	wall=0
	key=1
	door=2
	anim1=3
	anim2=4
	lose=6
	win=7
end

function draw_map()
	mapx=flr(p.x/16)*16
	mapy=flr(p.y/16)*16
	camera(mapx*8,mapy*8)
	
	map(0,0,0,0,128,64)
end

function is_tile(tile_type,x,y)
	tile=mget(x,y)
	return fget(tile,tile_type)	
end

function can_move(x,y)
	return not is_tile(wall,x,y)
end

function swap_tile(x,y)
	tile=mget(x,y)
	mset(x,y,tile+1)
end

function get_key(x,y)
	p.keys+=1
	swap_tile(x,y)
	sfx(1)
end

function open_door(x,y)
	p.keys-=1
	swap_tile(x,y)
	sfx(2)
end

-->8
-- player code
function make_player()
	p={}
	p.x=3
	p.y=2
	p.sprite=49
	p.keys=0
end

function draw_player()
	-- map coords need to be 
	-- multiplied by 8
	spr(p.sprite,p.x*8,p.y*8)
end

function move_player()
	newx=p.x
	newy=p.y
	
	if (btnp(⬅️)) newx-=1
	if (btnp(➡️)) newx+=1
	if (btnp(⬆️)) newy-=1
	if (btnp(⬇️)) newy+=1
	
	interact(newx,newy)
	
	if (can_move(newx,newy)) then
		p.x=mid(0,newx,127)
		p.y=mid(0,newy,63)
	else
		sfx(0)
	end
end

function interact(x,y)
	if (is_tile(key,x,y)) then
		get_key(x,y)
	elseif (is_tile(door,x,y) and p.keys>0) then
		open_door(x,y)
	end
end

-->8
-- inventory code
function show_inventory()
	invx=mapx*8+40
	invy=mapy*8+8
	
	rectfill(invx,invy,invx+48,invy+24,0)
	print("inventory",invx+7,invy+4,7)
	print("keys: "..p.keys,invx+12,invy+14,9)
end

__gfx__
00000000333333333333333333111333000000003333333333333333000000000000000000000000000000000000000000000000000000000000000000000000
00000000333333333333333331555133000000009993333333333333000000000000000000000000000000000000000000000000000000000000000000000000
00700700333333333bb3333315575513000000009399999933333333000000000000000000000000000000000000000000000000000000000000000000000000
000770003333333333bb33b315557513000000009a9aa9a933333333000000000000000000000000000000000000000000000000000000000000000000000000
0007700033333333333b3bb3125555510000000099933a3a33333333000000000000000000000000000000000000000000000000000000000000000000000000
007007003333333333333b331255755100000000aaa3333333333333000000000000000000000000000000000000000000000000000000000000000000000000
000000003333333333333b3331225513000000003333333333333333000000000000000000000000000000000000000000000000000000000000000000000000
00000000333333333333333333111133000000003333333333333333000000000000000000000000000000000000000000000000000000000000000000000000
00000000111111111111111111111111000000004a4444a4aaa99aaa000000000000000000000000000000000000000000000000000000000000000000000000
000000001111111111c1c1c111555551000000004a4444a44a4994a4000000000000000000000000000000000000000000000000000000000000000000000000
00000000111111111c1c1c1111575751000000004a4444a411111111000000000000000000000000000000000000000000000000000000000000000000000000
00000000111111111111111111515551000000004a4444a411111111000000000000000000000000000000000000000000000000000000000000000000000000
0000000011111111111111111551751100000000aaa99aaa11111111000000000000000000000000000000000000000000000000000000000000000000000000
000000001111111111c1c1c1c2255511000000001a1991a111111111000000000000000000000000000000000000000000000000000000000000000000000000
00000000111111111c1c1c11cc255111000000004944449449444494000000000000000000000000000000000000000000000000000000000000000000000000
0000000011111111111111111cccc111000000004a4444a44a4444a4000000000000000000000000000000000000000000000000000000000000000000000000
00000000666666666666666666656656000000005555555555555555000000000000000000000000000000000000000000000000000000000000000000000000
00000000666666666666666655555555000000005544445555000055000000000000000000000000000000000000000000000000000000000000000000000000
00000000666666666656656665666566000000005444444550000005000000000000000000000000000000000000000000000000000000000000000000000000
00000000666666665666666655555555000000005114444550000005000000000000000000000000000000000000000000000000000000000000000000000000
00000000666666666666666656665666000000005444444550000005000000000000000000000000000000000000000000000000000000000000000000000000
00000000666666666665665655555555000000005444464550000005000000000000000000000000000000000000000000000000000000000000000000000000
00000000666666666566666666656665000000005114444550000005000000000000000000000000000000000000000000000000000000000000000000000000
00000000666666666666666655555555000000005444444550000005000000000000000000000000000000000000000000000000000000000000000000000000
00000000000440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000440000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000099889900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000909999090000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000409999040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000aaaa000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000a00a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000a00a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000000100020000000000000000000000010101000301000000000000000000000000010005000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0101010102010101010101010111131101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101030101010201020103051111010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0102020103010115010111111101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010102010101011211010301020101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0501010322220113111101010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0102010122111211111301010215010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0301011122112323232323030102010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0111121122222521212123010101010301010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1111010102012321212123010201020101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101012323232323010101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010201022323111111120101020101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0102010101011111111211111111010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0201010102011111121113111211010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101020101011111111311111111010201010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0102010102011113111211121111010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101111111110101010101010101010101010101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000400001103000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000500002907000000360703607036070360603605036030360203601000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0006000012050120501d0502905027000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
